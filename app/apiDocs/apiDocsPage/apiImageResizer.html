{{define "page"}}
{{ template "header" . }}
<main class="container">
    {{ template "breadcrumbs" . }}
    {{ template "pageHeader" . }}
    <section>
        <form id="form">
            <div>
                {{ template "projectIDSelect" . }}
                <div>
                    <label for="image-src">Image URL: <span class="required">*</span></label>
                    <input type="url" id="image-src" name="imageUrl" placeholder="Enter image URL" required />
                </div>
                <div>
                    <label for="image-width">Width: <span class="required">*</span></label>
                    <input type="number" id="image-width" name="width" placeholder="Width in pixels" min="1" max="1000"
                        value="600" required />
                </div>
                <div>
                    <label for="image-height">Height: <span class="required">*</span></label>
                    <input type="number" id="image-height" name="height" placeholder="Height in pixels" min="1"
                        max="1000" value="400" required />
                </div>
                <div>
                    <button type="submit" id="resize-button">Resize</button>
                </div>
            </div>
        </form>
        <div>
            <p>
                <strong>Endpoint:</strong>
            </p>
            <p>
                <code id="api-endpoint" style="word-break: break-all;"></code>
            </p>
        </div>
        <div>
            <p>
                <strong>Output:</strong>
            </p>
            <img id="output" style="border: none; outline: none;" />
        </div>
        <script>
            const form = document.getElementById('form');
            const imageSrcInput = document.getElementById('image-src');
            const imageWidthInput = document.getElementById('image-width');
            const imageHeightInput = document.getElementById('image-height');
            const projectIDSelect = document.getElementById('project-select');
            const outputImage = document.getElementById('output');
            const apiEndpoint = document.getElementById('api-endpoint');
            const resizeTitle = document.getElementById('resize-title');
            const getMinWidth = () => parseInt(imageWidthInput.getAttribute('min'));
            const getMaxWidth = () => parseInt(imageWidthInput.getAttribute('max'));
            const getMinHeight = () => parseInt(imageHeightInput.getAttribute('min'));
            const getMaxHeight = () => parseInt(imageHeightInput.getAttribute('max'));
            const getWidth = () => parseInt(imageWidthInput.value);
            const getHeight = () => parseInt(imageHeightInput.value);

            const ENDPOINT = '{{.Endpoint}}';
            const getApiEndpoint = () => {
                const projectID = projectIDSelect.value;
                const imageURL = imageSrcInput.value;
                const width = getWidth();
                const height = getHeight();
                const params = new URLSearchParams();
                params.set('url', imageURL);
                params.set('width', width.toString());
                params.set('height', height.toString());
                params.set('projectID', projectID);
                const endpoint = ENDPOINT + '?' + params.toString();
                return endpoint;
            }


            const updateUI = () => {
                outputImage.width = getWidth();
                outputImage.height = getHeight();
                apiEndpoint.textContent = getApiEndpoint();

            }

            updateUI()
            imageWidthInput.addEventListener('input', updateUI);
            imageHeightInput.addEventListener('input', updateUI);
            projectIDSelect.addEventListener('change', updateUI);
            imageSrcInput.addEventListener('input', updateUI);


            form.addEventListener('submit', (event) => {
                event.preventDefault();
                outputImage.src = getApiEndpoint();
            });
        </script>
    </section>
</main>
{{end}}